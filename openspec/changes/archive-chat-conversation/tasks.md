## 1. 基础设施准备

- [x] 1.1 创建 `src/command/chat/archive.rs` 归档管理模块
- [x] 1.2 定义 `ChatArchive` 数据结构（包含 name、created_at、messages 字段）
- [x] 1.3 实现 `get_archives_dir()` 函数，获取归档目录路径
- [x] 1.4 实现 `ensure_archives_dir()` 函数，确保归档目录存在
- [x] 1.5 在 `src/command/chat/mod.rs` 中添加 archive 模块引用

## 2. 归档核心功能实现

- [x] 2.1 实现 `list_archives()` 函数，列出所有归档文件
- [x] 2.2 实现 `create_archive()` 函数，创建新归档文件
- [x] 2.3 实现 `restore_archive()` 函数，从归档恢复消息
- [x] 2.4 实现 `delete_archive()` 函数，删除归档文件
- [x] 2.5 实现 `validate_archive_name()` 函数，校验归档名称合法性
- [x] 2.6 实现 `generate_default_archive_name()` 函数，生成默认名称（格式：archive-YYYY-MM-DD，重名时自动添加 (1)(2) 后缀）

## 3. 归档文件操作

- [x] 3.1 实现归档文件的 JSON 序列化和反序列化
- [x] 3.2 添加归档文件读取的容错处理（损坏、不存在等情况）
- [x] 3.3 实现归档名称冲突检测（同名归档是否存在）
- [x] 3.4 实现归档列表排序（按创建时间倒序）

## 4. ChatApp 状态扩展

- [x] 4.1 在 `ChatApp` 结构体中添加归档列表状态字段
- [x] 4.2 在 `ChatApp` 结构体中添加归档模式相关字段
- [x] 4.3 扩展 `ChatMode` 枚举，添加 `ArchiveList` 和 `ArchiveConfirm` 模式
- [x] 4.4 实现归档确认模式的状态管理（默认名称、自定义名称输入）

## 5. 归档对话功能集成

- [x] 5.1 重构 `clear_session()` 方法为 `archive_session()`
- [x] 5.2 实现归档确认交互逻辑（用户按 Ctrl+L 后的提示和输入）
- [x] 5.3 实现归档成功后清空当前会话
- [x] 5.4 实现空会话时无法归档的提示

## 6. 还原归档功能集成

- [x] 6.1 实现进入归档列表模式的逻辑（Ctrl+R）
- [x] 6.2 实现归档列表渲染
- [x] 6.3 实现归档列表导航（上下键、j/k 键）
- [x] 6.4 实现选择归档并还原（Enter 键）
- [x] 6.5 实现还原时当前会话有消息的确认提示
- [x] 6.6 实现还原成功后重置会话状态（滚动位置、输入框、缓存）
- [x] 6.7 实现取消还原操作（Esc 键）

## 7. 归档删除功能

- [x] 7.1 在归档列表中实现删除功能（d 键）
- [x] 7.2 实现删除确认提示
- [x] 7.3 实现删除成功后刷新归档列表

## 8. UI 渲染更新

- [x] 8.1 在 `src/command/chat/ui.rs` 中添加归档确认界面渲染
- [x] 8.2 添加归档列表界面渲染
- [x] 8.3 更新帮助界面，添加 Ctrl+R 说明
- [x] 8.4 实现操作提示栏（底部提示文字）

## 9. 快捷键处理更新

- [x] 9.1 修改 `handle_chat_mode()` 中 Ctrl+L 的处理逻辑
- [x] 9.2 添加 `handle_archive_confirm_mode()` 函数处理归档确认模式
- [x] 9.3 添加 `handle_archive_list_mode()` 函数处理归档列表模式
- [x] 9.4 在 handler.rs 中导入 archive 模块

## 10. 测试和验证

- [ ] 10.1 测试默认名称归档功能
- [ ] 10.2 测试自定义名称归档功能
- [ ] 10.3 测试归档名称校验（非法字符、长度、冲突）
- [ ] 10.4 测试归档列表导航和选择
- [ ] 10.5 测试还原归档功能
- [ ] 10.6 测试还原时当前会话有消息的提示
- [ ] 10.7 测试归档删除功能
- [ ] 10.8 测试空会话归档提示
- [ ] 10.9 测试空归档列表提示
- [ ] 10.10 测试归档文件损坏时的容错处理

## 11. 文档更新

- [ ] 11.1 更新项目 README 中的功能说明
- [ ] 11.2 更新 assets/help.md 帮助文档

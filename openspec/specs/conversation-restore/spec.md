## ADDED Requirements

### Requirement: 还原归档对话
系统 SHALL 允许用户从归档中恢复对话到当前会话。

#### Scenario: 进入还原模式
- **WHEN** 用户按下 Ctrl+R
- **THEN** 系统进入还原模式
- **AND** 显示所有归档列表供选择

#### Scenario: 选择并还原归档
- **WHEN** 用户在归档列表中选中某个归档
- **AND** 用户按下 Enter 确认
- **THEN** 系统清空当前会话的所有消息
- **AND** 从归档文件加载消息到当前会话
- **AND** 显示成功提示 "已还原归档: <名称>"
- **AND** 返回聊天模式

#### Scenario: 还原时当前会话有消息
- **WHEN** 用户选择还原某个归档
- **AND** 当前会话有未归档的消息
- **THEN** 系统提示 "当前对话未归档，还原将丢失当前对话，是否继续？"
- **AND** 用户确认后继续还原
- **OR** 用户取消后返回归档列表

#### Scenario: 取消还原操作
- **WHEN** 用户在归档列表中按下 Esc
- **THEN** 系统返回聊天模式
- **AND** 当前会话保持不变

### Requirement: 归档列表导航
系统 SHALL 提供方便的归档列表导航功能。

#### Scenario: 上下导航
- **WHEN** 用户在归档列表中按上/下方向键或 j/k 键
- **THEN** 系统移动选中项
- **AND** 支持循环导航（第一项向上到最后一项，最后一项向下到第一项）

#### Scenario: 归档信息显示
- **WHEN** 用户浏览归档列表
- **THEN** 每个归档显示：
  - 归档名称
  - 消息数量
  - 创建时间

### Requirement: 还原后状态重置
系统 SHALL 在还原归档后正确重置会话状态。

#### Scenario: 重置滚动位置
- **WHEN** 归档还原完成
- **THEN** 滚动位置重置到顶部（或最新消息）

#### Scenario: 重置输入状态
- **WHEN** 归档还原完成
- **THEN** 输入框清空
- **AND** 光标位置重置

#### Scenario: 重新渲染界面
- **WHEN** 归档还原完成
- **THEN** 消息缓存清空
- **AND** 界面重新渲染显示还原的消息

### Requirement: 归档文件读取容错
系统 SHALL 在读取归档文件时进行容错处理。

#### Scenario: 归档文件损坏
- **WHEN** 选中的归档文件 JSON 格式损坏
- **THEN** 系统显示错误提示 "归档文件已损坏"
- **AND** 不执行还原操作
- **AND** 返回归档列表

#### Scenario: 归档文件不存在
- **WHEN** 选中的归档文件已被删除
- **THEN** 系统显示错误提示 "归档文件不存在"
- **AND** 刷新归档列表

#### Scenario: 归档文件消息格式错误
- **WHEN** 归档文件中某条消息缺少必要字段（role 或 content）
- **THEN** 系统跳过该条消息
- **AND** 继续加载其他消息
- **AND** 显示警告提示 "部分消息加载失败"

### Requirement: 还原模式交互
系统 SHALL 在还原模式下提供清晰的交互指引。

#### Scenario: 显示操作提示
- **WHEN** 用户进入还原模式
- **THEN** 界面底部显示操作提示：
  - Enter: 还原选中归档
  - d: 删除选中归档
  - Esc: 返回聊天

#### Scenario: 空归档列表提示
- **WHEN** 用户进入还原模式
- **AND** 不存在任何归档文件
- **THEN** 系统显示 "暂无归档对话"
- **AND** 显示提示 "按 Esc 返回聊天"
